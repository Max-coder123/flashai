<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcards View</title>
    <link rel="stylesheet" href="/static/global.css">
    <link rel="stylesheet" href="/static/cards.css">

    <style>
        h1 {
            margin: 6px 0 12px 0;
            font-size: 1.6em;
        }

        #buttonContainer {
            margin: 12px auto 6px auto;
            /* a bit more above, tighter below */
        }

        .flashcard-container {
            margin-top: 6px;
            /* slightly tighter gap below controls */
        }

        .back-to-history-btn {
            background-color: #031738;
            color: #e6e5e7;
            border: none;
            padding: 0.8em 1.5em;
            border-radius: 8px;
            font-family: "Montserrat", sans-serif;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            margin-top: 20px;
            margin-bottom: 16px;
            /* add space from bottom edge */
        }

        .back-to-history-btn:hover {
            background-color: #031738;
            color: #ffffff;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
        }

        /* No extra page-specific mobile controls styles needed; reuse cards.css */
    </style>
</head>

<body>
    {% include 'partials/_nav.html' %}
    <div class="main-content" id="main-content">
        <h1>{{flashcard_source.title}}</h1>

        <div class="shuffle-button-container" id="buttonContainer" style="display: none;">
            <button id="previousCardMobile" class="previous-card" style="display: none;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                </svg>
            </button>

            <div class="tooltip">
                <button class="shuffle-icon-button" id="shuffleButton">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M3.75 8l5.75 4-5.75 4V8zm7.75 0v8h8V8h-8z" />
                    </svg>
                </button>
                <span class="tooltiptext">Shuffle Cards</span>
            </div>

            <div class="tooltip">
                <button class="flip-icon-button" id="flipAllButton">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path
                            d="M15.88 3.79L14.46 5.21c1.95 1.77 3.04 4.23 3.04 6.79s-1.09 5.02-3.04 6.79l1.42 1.42C17.88 17.89 19.2 14.55 19.2 12s-1.32-5.89-3.32-8.21zm-9.76 0C4.12 6.11 2.8 9.45 2.8 12s1.32 5.89 3.32 8.21l1.42-1.42C5.59 17.02 4.5 14.55 4.5 12s1.09-5.02 3.04-6.79L6.12 3.79z" />
                    </svg>
                </button>
                <span class="tooltiptext">Flip Cards</span>
            </div>

            <button id="nextCardMobile" class="next-card" style="display: none;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z" />
                </svg>
            </button>
        </div>

        <div class="flashcard-container">
            <button id="previousCard" class="previous-card" style="display: none;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                </svg>
            </button>
            <div id="completion"></div>
            <button id="nextCard" class="next-card" style="display: none;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z" />
                </svg>
            </button>
        </div>

        <div class="card-index"></div>

        <button onclick="window.location.href='/history'" class="back-to-history-btn">Back to History</button>
    </div>
    <script>
        const completionEl = document.getElementById("completion");
        const prevButton = document.getElementById("previousCard");
        const nextButton = document.getElementById("nextCard");
        const buttonContainer = document.getElementById("buttonContainer");
        const prevButtonMobile = document.getElementById("previousCardMobile");
        const nextButtonMobile = document.getElementById("nextCardMobile");
        let activeCardIndex = 0;
        let cards;

        // Use the flashcards data passed from Flask
        const data = {{ flashcard_set | safe}};

        function renderFlashcards() {
            if (data.length === 0) {
                prevButton.style.display = "none";
                nextButton.style.display = "none";
                buttonContainer.style.display = "none";
                return;
            }

            prevButton.style.display = "inline-block";
            nextButton.style.display = "inline-block";
            if (buttonContainer) buttonContainer.style.display = "flex";
            if (prevButtonMobile) prevButtonMobile.style.display = "inline-block";
            if (nextButtonMobile) nextButtonMobile.style.display = "inline-block";

            completionEl.innerHTML = "";
            data.forEach((item, i) => {
                completionEl.innerHTML += `
                <div class=\"flashcard ${i === activeCardIndex ? "active-card" : ""}\">
                    <div class=\"flashcard-inner\">
                        <div class=\"flashcard-front\">
                            <div class=\"flashcard-content\">${item.question}</div>
                        </div>
                        <div class=\"flashcard-back\">
                            <div class=\"flashcard-content\">${item.answer}</div>
                        </div>
                    </div>
                </div>`;
            });

            cards = document.querySelectorAll('.flashcard');
            cards.forEach(card => card.addEventListener('click', () => card.classList.toggle('flip')));
            updateControlsVisibility();
        }

        const cardIndexEl = document.querySelector(".card-index");

        function updateCardIndex() {
            cardIndexEl.textContent = `${activeCardIndex + 1}/${cards.length}`;
        }

        renderFlashcards();
        cards = document.querySelectorAll('.flashcard');
        updateCardIndex();

        function goNext() {
            const currentCard = cards[activeCardIndex];
            currentCard.classList.remove('active-card');
            activeCardIndex = (activeCardIndex + 1) % cards.length;
            updateCardIndex();
            cards[activeCardIndex].classList.add('active-card');
        }
        function goPrev() {
            const currentCard = cards[activeCardIndex];
            currentCard.classList.remove('active-card');
            activeCardIndex = (activeCardIndex - 1 + cards.length) % cards.length;
            updateCardIndex();
            cards[activeCardIndex].classList.add('active-card');
        }

        document.querySelectorAll('.next-card').forEach(btn => btn.addEventListener('click', goNext));
        document.querySelectorAll('.previous-card').forEach(btn => btn.addEventListener('click', goPrev));

        // Show mobile arrows only on small screens (desktop uses side arrows)
        function updateControlsVisibility() {
            const isMobile = window.innerWidth <= 768;
            const prevButtonMobile = document.getElementById('previousCardMobile');
            const nextButtonMobile = document.getElementById('nextCardMobile');
            if (prevButtonMobile) prevButtonMobile.style.display = isMobile ? 'inline-block' : 'none';
            if (nextButtonMobile) nextButtonMobile.style.display = isMobile ? 'inline-block' : 'none';
        }
        updateControlsVisibility();
        window.addEventListener('resize', updateControlsVisibility);

        // Flip all
        function flipAllCards() {
            if (!cards || cards.length === 0) return;
            const shouldFlipToBack = !cards[0].classList.contains('flip');
            cards.forEach(card => {
                if (shouldFlipToBack) card.classList.add('flip');
                else card.classList.remove('flip');
            });
        }
        document.getElementById('flipAllButton').addEventListener('click', flipAllCards);

        // Shuffle
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        function shuffleCards() {
            shuffleArray(data);
            activeCardIndex = 0;
            renderFlashcards();
            updateCardIndex();
        }
        document.getElementById('shuffleButton').addEventListener('click', shuffleCards);

    </script>

</body>


</html>